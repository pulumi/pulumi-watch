name: Main branch

on:
  push:
    branches:
      - main
      - main-v*

concurrency: release

jobs:
  info:
    name: Gather info
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
    steps:
    - name: Compute version
      id: version
      shell: bash
      run: |
        # Sets output VERSION
        ./.github/scripts/get-version
  prerelease:
    needs: [info]
    uses: ./.github/workflows/prerelease.yml
    with:
      version: ${{ needs.info.outputs.version }}
    secrets: inherit
